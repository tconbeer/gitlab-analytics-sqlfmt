with
    zuora_revenue_revenue_contract_bill as (

        select *
        from {{ source("zuora_revenue", "zuora_revenue_revenue_contract_bill") }}
        qualify rank() OVER (partition by id order by incr_updt_dt desc) = 1

    ),
    renamed as (

        select

            id::varchar as revenue_contract_bill_id,
            rc_id::varchar as revenue_contract_id,
            ext_sll_prc::float as external_selling_price,
            def_amt::float as deferred_amount,
            rec_amt::float as recognized_amount,
            alctbl_xt_prc::float as allocatable_external_price,
            cstmr_nm::varchar as customer_name,
            invoice_num::varchar as invoice_number,
            invoice_date::datetime as invoice_date,
            invoice_line_num::varchar as invoice_item_number,
            invoice_line_id::varchar as invoice_item_id,
            item_num::varchar as item_number,
            bndl_cnfg_id::varchar as bundle_configuration_id,
            invoice_qty::varchar as invoice_quantity,
            start_date::datetime as revenue_start_date,
            end_date::datetime as revenue_end_date,
            duration::varchar as revenue_amortization_duration,
            ext_lst_prc::varchar as extended_selling_price,
            batch_id::varchar as revenue_contract_batch_id,
            book_id::varchar as book_id,
            curr::varchar as transactional_currency,
            f_cur::varchar as functional_currency,
            f_ex_rate::varchar as functional_exchange_rate,
            g_ex_rate::varchar as reporting_currency_exchange_rate,
            ref_doc_line_id::varchar as reference_document_line_id,
            ref_bill_id::varchar as reference__bill_id,
            lt_def_acnt::varchar as long_term_deferred_account,
            def_segments::varchar as deferred_accounting_segment,
            rev_segments::varchar as revenue_accounting_segment,
            atr1::varchar as revenue_contract_bill_attribute_1,
            atr2::varchar as revenue_contract_bill_attribute_2,
            atr3::varchar as revenue_contract_bill_attribute_3,
            atr4::varchar as revenue_contract_bill_attribute_4,
            atr5::varchar as revenue_contract_bill_attribute_5,
            atr6::varchar as revenue_contract_bill_attribute_6,
            atr7::varchar as revenue_contract_bill_attribute_7,
            atr8::varchar as revenue_contract_bill_attribute_8,
            atr9::varchar as revenue_contract_bill_attribute_9,
            atr10::varchar as revenue_contract_bill_attribute_10,
            atr11::varchar as revenue_contract_bill_attribute_11,
            atr12::varchar as revenue_contract_bill_attribute_12,
            atr13::varchar as revenue_contract_bill_attribute_13,
            atr14::varchar as revenue_contract_bill_attribute_14,
            atr15::varchar as revenue_contract_bill_attribute_15,
            atr16::varchar as revenue_contract_bill_attribute_16,
            atr17::varchar as revenue_contract_bill_attribute_17,
            atr18::varchar as revenue_contract_bill_attribute_18,
            atr19::varchar as revenue_contract_bill_attribute_19,
            atr20::varchar as revenue_contract_bill_attribute_20,
            atr21::varchar as revenue_contract_bill_attribute_21,
            atr22::varchar as revenue_contract_bill_attribute_22,
            atr23::varchar as revenue_contract_bill_attribute_23,
            atr24::varchar as revenue_contract_bill_attribute_24,
            atr25::varchar as revenue_contract_bill_attribute_25,
            atr26::varchar as revenue_contract_bill_attribute_26,
            atr27::varchar as revenue_contract_bill_attribute_27,
            atr28::varchar as revenue_contract_bill_attribute_28,
            atr29::varchar as revenue_contract_bill_attribute_29,
            atr30::varchar as revenue_contract_bill_attribute_30,
            atr31::varchar as revenue_contract_bill_attribute_31,
            atr32::varchar as revenue_contract_bill_attribute_32,
            atr33::varchar as revenue_contract_bill_attribute_33,
            atr34::varchar as revenue_contract_bill_attribute_34,
            atr35::varchar as revenue_contract_bill_attribute_35,
            atr36::varchar as revenue_contract_bill_attribute_36,
            atr37::varchar as revenue_contract_bill_attribute_37,
            atr38::varchar as revenue_contract_bill_attribute_38,
            atr39::varchar as revenue_contract_bill_attribute_39,
            atr40::varchar as revenue_contract_bill_attribute_40,
            atr41::varchar as revenue_contract_bill_attribute_41,
            atr42::varchar as revenue_contract_bill_attribute_42,
            atr43::varchar as revenue_contract_bill_attribute_43,
            atr44::varchar as revenue_contract_bill_attribute_44,
            atr45::varchar as revenue_contract_bill_attribute_45,
            atr46::varchar as revenue_contract_bill_attribute_46,
            atr47::varchar as revenue_contract_bill_attribute_47,
            atr48::varchar as revenue_contract_bill_attribute_48,
            atr49::varchar as revenue_contract_bill_attribute_49,
            atr50::varchar as revenue_contract_bill_attribute_50,
            atr51::varchar as revenue_contract_bill_attribute_51,
            atr52::varchar as revenue_contract_bill_attribute_52,
            atr53::varchar as revenue_contract_bill_attribute_53,
            atr54::varchar as revenue_contract_bill_attribute_54,
            atr55::varchar as revenue_contract_bill_attribute_55,
            atr56::varchar as revenue_contract_bill_attribute_56,
            atr57::varchar as revenue_contract_bill_attribute_57,
            atr58::varchar as revenue_contract_bill_attribute_58,
            atr59::varchar as revenue_contract_bill_attribute_59,
            atr60::varchar as revenue_contract_bill_attribute_60,
            num1::float as revenue_contract_bill_number_1,
            num2::float as revenue_contract_bill_number_2,
            num3::float as revenue_contract_bill_number_3,
            num4::float as revenue_contract_bill_number_4,
            num5::float as revenue_contract_bill_number_5,
            num6::float as revenue_contract_bill_number_6,
            num7::float as revenue_contract_bill_number_7,
            num8::float as revenue_contract_bill_number_8,
            num9::float as revenue_contract_bill_number_9,
            num10::float as revenue_contract_bill_number_10,
            num11::float as revenue_contract_bill_number_11,
            num12::float as revenue_contract_bill_number_12,
            num13::float as revenue_contract_bill_number_13,
            num14::float as revenue_contract_bill_number_14,
            num15::float as revenue_contract_bill_number_15,
            date1::datetime as revenue_contract_bill_date_1,
            date2::datetime as revenue_contract_bill_date_2,
            date3::datetime as revenue_contract_bill_date_3,
            date4::datetime as revenue_contract_bill_date_4,
            date5::datetime as revenue_contract_bill_date_5,
            credit_rule::varchar as credit__rule,
            rel_pct::float as recognized_percent,
            cost_amt::float as cost_amount,
            cost_def_amt::float as cost_deferred_amt,
            cost_rec_amt::float as cost_recognized_amt,
            cost_curr::varchar as cost_transactional_curr,
            cost_fx_rate::varchar as cost_functional_currency_exchange_rate,
            dcog_segments::varchar as deferred_cogs_segment,
            rcog_segments::varchar as recognized_cogs_segment,
            line_id::varchar as revenue_contract_line_id,
            concat(
                crtd_prd_id::varchar, '01'
            ) as revenue_contract_bill_created_period_id,
            client_id::varchar as client_id,
            sec_atr_val::varchar as security_attribute_value,
            crtd_by::varchar as revenue_contract_bill_created_by,
            crtd_dt::datetime as revenue_contract_bill_created_date,
            updt_by::varchar as revenue_contract_bill_updt_by,
            updt_dt::datetime as revenue_contract_bill_updt_dt,
            incr_updt_dt::datetime as incremental_update_date,
            type::varchar as revenue_contract_bill_type,
            business_unit::varchar as business_unit,
            ct_mod_date::datetime as revenue_contract_line_modification_date,
            cust_num::varchar as customer_number,
            def_offset_segs::varchar as deferred_offset_account,
            fv_date::varchar as fair_value_date,
            model_id::varchar as model_id,
            po_num::varchar as purchase_order_number,
            prod_class::varchar as product_class,
            prod_ctgry::varchar as product_category,
            prod_fmly::varchar as product_family,
            prod_ln::varchar as product_line,
            quote_num::varchar as quote_number,
            rev_offset_segs::varchar as revenue_offset_account,
            sales_rep_name::varchar as sales_representative_name,
            schd_ship_dt::varchar as scheduled_ship_date,
            ship_dt::datetime as ship_dt,
            sob_id::varchar as set_of_books_id,
            unit_sell_prc::float as unit_sell_price,
            unit_list_prc::float as unit_list_price,
            bndl_prnt_id::varchar as bundle_parent_id,
            company_code::varchar as company_code,
            ca_account::varchar as contract_asset_account,
            ci_account::varchar as ci_account,
            al_account::varchar as al_account,
            contra_ar_acct::varchar as contra_ar_account,
            payables_acct::varchar as payables_account,
            lt_def_adj_acct::varchar as long_term_deferred_adjustment_account,
            ub_liab_acct::varchar as ub_liability_account,
            ic_account::varchar as intercompany_account,
            alloc_rec_hold_flag::varchar as is_allocation_recognition_hold,
            alloc_schd_hold_flag::varchar as is_allocation_schedule_hold,
            approval_status_flag::varchar as approval_status,
            contra_entry_flag::varchar as is_contra_entry,
            cv_eligible_flag::varchar as is_carve_eligible,
            disc_adj_flag::varchar as is_disc_adjustment,
            fv_eligible_flag::varchar as is_fair_value_eligible,
            impairment_type_flag::varchar as impairment_type,
            manual_fv_flag::varchar as is_manual_fair_value,
            reclass_flag::varchar as is_reclass,
            return_flag::varchar as is_return,
            rev_rec_hold_flag::varchar as is_revenue_recogition_hold,
            rev_schd_hold_flag::varchar as is_revenue_schedule_hold,
            rssp_calc_type::varchar as rssp_calcultion_type,
            standalone_flag::varchar as is_standalone,
            stated_flag::varchar as is_stated,
            within_fv_range_flag::varchar as is_within_fair_value_range,
            ar_account::varchar as ar_account,
            cancel_flag::varchar as is_canceled,
            impairment_type_code::varchar as impairment_type_code,
            impairment_type_name::varchar as impairment_type_name,
            cv_eligible_lvl2_flag::varchar as is_level_2_allocation_eligible,
            lt_def_cogs_acct::varchar as long_term_deferred_cogs_account,
            lt_ca_account::varchar as long_term_ca_account,
            rord_updt_flag::varchar as is_reduction_order_update,
            ovr_std_incld_flag::varchar as is_ovr_std_included,
            cm_cancel_flag::varchar as is_cm_cancel,
            action_type::varchar as amendment_action_type,
            cost_gx_rate::varchar as cost_bill_exchange_rate,
            skip_ct_mod_flag::varchar as is_skip_ct_mod,
            rem_init_entry_amt::float as rem_init_entry_amount,
            subscrp_term_num::varchar as subscrpription_term,
            rord_knock_off_flag::varchar as is_reduction_order_knock_off,
            sys_gnrtd_cmc_flag::varchar as is_system_generated_cmc,
            sys_conv_cmro_flag::varchar as is_system_converted_cmro,
            so_term_rec_flag::varchar as is_sales_order_term_recognition,
            zbill_true_up_flag::varchar as is_zbill_true_up,
            retain_line_id_flag::varchar as is_retain_line_id,
            avoid_overage_flag::varchar as is_avoid_overage

        from zuora_revenue_revenue_contract_bill

    )

select *
from renamed
